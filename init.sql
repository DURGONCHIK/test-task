DO $$
BEGIN
    IF NOT EXISTS (SELECT FROM pg_database WHERE datname = 'user') THEN
        CREATE DATABASE "user" WITH OWNER = postgres;
END IF;
END $$;

-- Подключение к базе данных
\c "user";

-- Включение расширения для работы с текстовыми схожестями
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'pg_trgm') THEN
        CREATE EXTENSION pg_trgm;
END IF;
END $$;

-- Создание таблицы ответов
CREATE TABLE IF NOT EXISTS responses (
                                         id SERIAL PRIMARY KEY,
                                         intent TEXT UNIQUE NOT NULL,
                                         response TEXT NOT NULL
);

-- Очистка таблицы перед вставкой обновлённых данных
TRUNCATE TABLE responses RESTART IDENTITY;

-- Вставка данных (с учётом стемминга)
INSERT INTO responses (intent, response) VALUES
                                             ('приветств', 'Привет! Чем могу помочь?'),
                                             ('прощан', 'До свидания! Хорошего дня.'),
                                             ('статус_заказ', 'Вы можете проверить статус заказа в личном кабинете.'),
                                             ('политик_возврат', 'Возврат возможен в течение 14 дней с момента покупки.'),
                                             ('контакт_поддержк', 'Вы можете связаться с поддержкой по телефону +7 900 123-45-67.'),
                                             ('доставк', 'Доставка занимает от 3 до 5 рабочих дней.'),
                                             ('способ_оплат', 'Мы принимаем Visa, MasterCard и PayPal.'),
                                             ('налич_товар', 'Вы можете проверить наличие товара на странице продукта.'),
                                             ('техподдержк', 'Опишите проблему, и я помогу вам её решить.'),
                                             ('измен_заказ', 'Вы можете изменить заказ в течение 24 часов после оформления.'),
                                             ('отмен_заказ', 'Для отмены заказа перейдите в раздел "Мои заказы".'),
                                             ('скидк', 'Актуальные скидки можно найти в разделе "Акции".'),
                                             ('программ_лояльност', 'В нашей бонусной программе вы можете накапливать баллы и обменивать их на скидки.'),
                                             ('адрес_магазин', 'Наши магазины находятся в Москве, Санкт-Петербурге и Екатеринбурге.'),
                                             ('час_работ', 'Мы работаем с 9:00 до 21:00 без выходных.'),
                                             ('возврат_товар', 'Чтобы вернуть товар, заполните форму на сайте и отправьте его обратно.'),
                                             ('отслеживан_заказ', 'Введите номер заказа на сайте, чтобы отследить его статус.'),
                                             ('гарант', 'На все товары действует гарантия 12 месяцев.'),
                                             ('отмен_подписк', 'Вы можете отменить подписку в настройках аккаунта.'),
                                             ('конфиденциальност', 'Мы строго соблюдаем политику конфиденциальности.'),
                                             ('контактн_email', 'Вы можете написать нам на support@example.com.'),
                                             ('восстановлен_парол', 'Используйте функцию восстановления пароля на странице входа.'),
                                             ('измен_аккаунт', 'Вы можете изменить данные аккаунта в настройках.'),
                                             ('сообщ_о_проблем', 'Опишите вашу проблему, и я помогу её решить.'),
                                             ('измен_адрес', 'Изменить адрес доставки можно до отправки заказа.'),
                                             ('вопрос_по_оплат', 'Все счета можно посмотреть в разделе "Платежи".'),
                                             ('жалоб', 'Если у вас есть жалоба, отправьте её через форму обратной связи.'),
                                             ('подписк_на_рассылк', 'Подписаться на рассылку можно в настройках профиля.'),
                                             ('вопрос_и_ответ', 'Вы можете найти ответы на популярные вопросы в разделе "Часто задаваемые вопросы".')
    ON CONFLICT (intent) DO NOTHING;